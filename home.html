<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <title>Trắc nghiệm Online</title>
    <link rel="icon" href="images/stu.png" type="image/x-icon">



    <!-- <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css"> -->
    <!-- icon -->
    <script src="lb/jquery.min.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <script src="lb/bootstrap.min.js"></script>
    <!-- <link rel="stylesheet" href="css/mdb.min.css"> -->
    <script src="lb/angular.min.js"></script>
    <link rel="stylesheet" href="css/sweetalert2.min.css">
    <!-- Gọi trình cắm SWAL (SWeet ALert ) -->
    <script src="lb/sweetalert2.min.js"></script>
    <!-- Gọi trình cắm SWAL (SWeet ALert ) -->
    <script src="lb/angular-route.js"></script>
    <!-- Animetion hiệu ứng chuyển động các slide -->
    <script src="lb/angular-animate.js"></script>

    <script src="lb/socket.io.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsencrypt/3.0.0-beta.1/jsencrypt.min.js"></script>

    <!-- <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script> -->





    <!-- Kết nối trước để tối ưu tốc độ tải -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Preload Google Fonts -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
        as="style" onload="this.onload=null;this.rel='stylesheet'">

    <!-- Fallback khi preload không chạy -->
    <noscript>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    </noscript>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-select/0.20.0/select.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-select/0.20.0/select.min.js"></script>
    <!--pdf-->

    <script src="lb/jspdf.umd.min.js"></script>
    <script src="lb/html2canvas.min.js"></script>
    <!-- EXCEL -->
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script> -->


    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>


    <link rel="stylesheet" href="css/home.css">

</head>

<body class="fixed-sn white-skin custom-ui" ng-app="myApp">

    <div class="toast-container" aria-live="polite" aria-atomic="true">
        <div class="toast toast-{{toast.type}}" ng-repeat="toast in toasts track by $index"
            ng-class="{'show': toast.state === 'show', 'hide': toast.state === 'hide'}">
            <div class="toast-content">
                <!-- nếu FontAwesome 6 không nhận 'fas', đổi sang 'fa-solid' -->
                <i class="fas fa-{{toast.icon}}"></i>
                <span>{{toast.message}}</span>
            </div>
        </div>
    </div>


    <aside class="sidebar" ng-controller="MainCtrl">
        <div class="logo-section">
            <div class="logo">
                <span class="logo-text">STU</span>
            </div>
            <h2 class="system-title">Hệ Thống Thi Trắc Nghiệm</h2>
        </div>

        <nav class="nav-menu">
            <a href="#!index" class="nav-item" ng-class="{active: isActive('/index')}">
                <i class="fas fa-home"></i>
                <span>Trang chủ</span>
            </a>
            <a href="#!connections" class="nav-item" ng-class="{active: isActive('/connections')}">
                <i class="fas fa-network-wired"></i>
                <span>Kết nối</span>
            </a>
            <!-- <a href="#!management" class="nav-item" ng-class="{active: isActive('/management')}">
                <i class="fas fa-cogs"></i>
                <span>Quản lý</span>
            </a> -->
            <a href="#!quiz" class="nav-item" ng-class="{active: isActive('/quiz')}">
                <i class="fas fa-question-circle"></i>
                <span>Quản lý câu hỏi</span>
            </a>

        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <button class="menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 class="page-title">THI TRẮC NGHIỆM</h1>
            </div>
            <div class="header-right">
                <button class="notification-btn" ng-click="openNotifications()">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge"
                        ng-if="notification_count_data>0">{{notification_count_data}}</span>
                </button>

                <!-- Notification Dropdown -->
                <div class="notification-dropdown active" ng-show="notification_dropdown">
                    <div class="notification-header">
                        <div class="notification-title">
                            <i class="fas fa-bell"></i>
                            <span>Thông báo</span>
                            <span ng-if="notification_count_data>0" class="unread-count" id="unread-count">{{notification_count_data}}</span>
                        </div>
                        <div class="notification-actions">
                            <select class="select-input small-select" ng-model="selectedStatus"
                                ng-change="filterStatus(selectedStatus)"
                                ng-options="s.value as s.label for s in statusOptions">
                            </select>
                            <button class="btn-mark-all-read" title="Đánh dấu tất cả đã đọc">
                                <i class="fas fa-check-double"></i>
                            </button>
                            <button class="btn-close" ng-click="openNotifications()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div ng-if="notification_data_tmp.length ==0" class="no-notifications">
                        <i class="fas fa-bell"></i>
                        <p>Không có thông báo mới</p>
                    </div>
                    <div class="notification-list">
                        <div ng-repeat="noti in notification_data_tmp track by $index">
                            <div class="notification-item {{!noti.status ? 'unread' : ''}}">
                                <div class="notification-icon">
                                    {{getNotificationIcon(noti.type)}}
                                </div>
                                <div class="notification-content">
                                    <div class="notification-text">
                                        <h4>{{noti.title}}</h4>
                                        <p>{{noti.message}}</p>
                                    </div>
                                    <div class="notification-meta">
                                        <span class="notification-time">{{formatTimeAgo(noti.time)}}</span>
                                        <button class="btn-mark-read" ng-if="!noti.status" title="Xác nhận"
                                            ng-click="acceptReconnect(noti.id)">
                                            <i class="fas fa-check"></i>
                                        </button>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="notification-footer">
                        <button class="btn-view-all">Xem tất cả thông báo</button>
                    </div>
                </div>

                <div class="user-profile" id="user-profile">
                    <img ng-click="openProfile()"
                        src="https://cdn3d.iconscout.com/3d/premium/thumb/administrator-3d-icon-png-download-4741054.png?f=webp"
                        alt="User" class="user-avatar">
                    <span ng-click="openProfile()" class="user-name">{{user.fullname}}</span>
                    <button class="btn-logout" ng-click="logout()"><i class="fa fa-sign-out"></i>
                    </button>
                </div>
            </div>
        </header>





        <div class="slide-container">
            <div ng-view class="slide-animation"></div>
        </div>


        <!-- <div class="container"> -->
        <!-- <div class="export-button">
                <button class="btn-export" ng-click="exportPDF()">
                    Xuất PDF
                </button>
            </div> -->

        <div id="examPdf" class="hidden">
            <div class="exam-header">
                <h1>
                    {{exam.discipline_name}}
                </h1>
            </div>

            <div class="exam-info">
                <div class="info-grid">
                    <div>
                        <div class="info-item">
                            <div class="info-label">Lớp:</div>
                            <div class="info-value">{{exam.classNameSelected}}</div>
                        </div>

                        <div class="info-item">
                            <div class="info-label">Họ tên:</div>
                            <div class="info-value">{{exam.nameSelected}}</div>
                        </div>

                        <div class="info-item">
                            <div class="info-label">MSSV:</div>
                            <div class="info-value mssv">{{exam.isSelected}}</div>
                        </div>
                    </div>

                    <div>
                        <div class="info-item">
                            <div class="info-label">Số câu:</div>
                            <div class="info-value">{{exam.countQuestions}}/{{exam.countQuestions}}</div>
                        </div>

                        <div class="info-item">
                            <div class="info-label">Thời gian:</div>
                            <div class="info-value">{{exam.time}}p - {{exam.submissionTime | date:'dd/MM/yyyy'}}
                            </div>
                        </div>

                        <div class="info-item">
                            <div class="info-label">Điểm:</div>
                            <div class="info-value">
                                <span class="score-badge">{{exam.mark}}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="questions-container">
                <div class="question-card" ng-repeat="q in exam.questions">
                    <div class="question-header">
                        <div class="question-number">{{$index + 1}}</div>
                        <div class="question-content">
                            <div class="question-left">
                                <div class="question-text">{{q.text_question}}</div>
                                <div class="answers-list">
                                    <div class="answer-item" ng-repeat="ans in q.Answers_Text" ng-init="index"
                                        ng-class="{'correct': ans.answer_option_id == q.correct_answer[0].correct_answer}">
                                        <div class="answer-option">{{getOptionLetter($index)}}</div>
                                        <div class="answer-text">{{ans.text_answer}}</div>
                                    </div>
                                </div>
                            </div>

                            <div class="question-images" ng-if="q.source_image && q.source_image.length > 0">
                                <div class="images-grid">
                                    <div class="image-placeholder" ng-repeat="img in q.source_image">
                                        <img ng-if="img.source_image" ng-src="{{img.source_image}}"
                                            alt="Hình {{$index + 1}}">
                                        <span ng-if="!img.source_image">{{img.content}}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- <div class="additional-images">
      <div class="additional-images-box">
        <div class="additional-images-text">
          Ảnh đính kèm bổ sung (Nếu có, tối đa 6 hình)
        </div>
      </div>
    </div> -->
        </div>
        <!-- </div> -->


    </main>



    <!-- Dialog xem chi tiết câu hỏi -->
    <div class="dialog-overlay" id="view-question-dialog">
        <div class="dialog">
            <div class="dialog-header">
                <h3>Chi tiết câu hỏi</h3>
                <button class="dialog-close" onclick="closeDialog('view-question-dialog')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="dialog-content">
                <div class="question-detail">
                    <div class="question-text" id="view-question-text">
                        <!-- Question content will be loaded here -->
                    </div>
                    <div class="question-answers" id="view-question-answers">
                        <!-- Answers will be loaded here -->
                    </div>
                    <div class="question-info">
                        <div class="info-item">
                            <strong>Độ khó:</strong> <span id="view-question-difficulty"></span>
                        </div>
                        <div class="info-item">
                            <strong>Người tạo:</strong> <span id="view-question-author"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Profile Modal -->
    <div class="modal-overlay active" ng-show="modelUser">
        <div class="modal-content profile-modal">
            <div class="modal-header">
                <h2>Thông tin tài khoản</h2>
                <button class="btn-close" ng-click="openProfile()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="modal-body">
                <div class="profile-section">
                    <div class="avatar-section">
                        <div class="avatar-container">
                            <img src="https://cdn3d.iconscout.com/3d/premium/thumb/administrator-3d-icon-png-download-4741054.png?f=webp"
                                alt="Avatar" class="profile-avatar" id="profile-avatar">
                            <input type="file" id="avatar-upload" accept="image/*" style="display: none;">
                            <label for="avatar-upload" class="avatar-upload-btn" id="avatar-upload-btn"
                                style="display: none;">
                                <i class="fas fa-camera"></i>
                            </label>
                        </div>
                        <div class="profile-basic">
                            <h3 id="profile-display-name">{{user.fullname}}</h3>
                            <p id="profile-display-position">{{user.department_name}}</p>
                            <span class="status-online">Đang hoạt động</span>
                        </div>
                    </div>

                    <div class="profile-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label>
                                    <i class="fas fa-user"></i>
                                    Họ và tên
                                </label>
                                <span class="form-value" id="name-display">{{user.fullname}}</span>
                                <input type="text" value="Nguyễn Văn Admin" class="form-input" id="name-input"
                                    style="display: none;">
                            </div>

                            <div class="form-group">
                                <label>
                                    <i class="fas fa-envelope"></i>
                                    Email
                                </label>
                                <span class="form-value" id="email-display">{{user.email}}</span>
                                <input type="email" value="admin@stu.edu.vn" class="form-input" id="email-input"
                                    style="display: none;">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>
                                    <i class="fas fa-phone"></i>
                                    Số điện thoại
                                </label>
                                <span class="form-value" id="phone-display">{{user.phone}}</span>
                                <input type="tel" value="0123456789" class="form-input" id="phone-input"
                                    style="display: none;">
                            </div>

                            <div class="form-group">
                                <label>
                                    <i class="fas fa-map-marker-alt"></i>
                                    Địa chỉ
                                </label>
                                <span class="form-value" id="address-display">TP. Hồ Chí Minh</span>
                                <input type="text" value="TP. Hồ Chí Minh" class="form-input" id="address-input"
                                    style="display: none;">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Khoa/Phòng ban</label>
                                <span class="form-value" id="department-display">{{user.department_name}}</span>
                                <input type="text" value="Khoa Công nghệ Thông tin" class="form-input"
                                    id="department-input" style="display: none;">
                            </div>

                            <div class="form-group">
                                <label>Chức vụ</label>
                                <span class="form-value" id="position-display">{{user.role}}</span>
                                <input type="text" value="Giảng viên" class="form-input" id="position-input"
                                    style="display: none;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- <div class="modal-footer">
                <button class="btn btn-primary" id="edit-profile-btn" onclick="toggleEditMode()">Chỉnh sửa</button>
                <button class="btn btn-outline" id="cancel-edit-btn" onclick="cancelEdit()"
                    style="display: none;">Hủy</button>
                <button class="btn btn-primary" id="save-profile-btn" onclick="saveProfile()" style="display: none;">
                    <i class="fas fa-save"></i>
                    Lưu thay đổi
                </button>
            </div> -->
        </div>
    </div>



    <script type="text/javascript" src="lb/mdb.min.js"></script>
    <script src="app/myapp.js"></script>
    <script src="app/ApiService.js"></script>
    <script src="app/IndexedDBService.js"></script>
    <script src="app/ExamService.js"></script>
    <script src="app/PDFService.js"></script>
    <script src="app/MainCtrl.js"></script>
    <script src="app/HomeViewCtrl.js"></script>
    <script src="app/ConnectionsCtrl.js"></script>
    <script src="app/ManagementCtrl.js"></script>
    <script src="app/QuizViewCtrl.js"></script>
    <script src="app/LoginCtrl.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


</body>

</html>